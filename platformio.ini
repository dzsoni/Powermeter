; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[platformio]
default_envs = esp32-s3-devkitc-1

[extra]
lib_deps_external = 
	https://github.com/ESP32Async/ESPAsyncTCP
	https://github.com/ESP32Async/ESPAsyncWebServer
	https://github.com/arkhipenko/TaskScheduler
    https://github.com/dzsoni/Command_Center
    https://github.com/dzsoni/MQTTMediator
    https://github.com/dzsoni/SimpleJsonParser
    https://github.com/dzsoni/BasicOTA
    https://github.com/dzsoni/SimpleJsonWriter
    https://github.com/dzsoni/async-mqtt-client

[env]
extra_scripts = pre:git_rev_macro.py
				pre:helper\html_minify.py
                pre:helper\html_compress.py

build_flags =
             ;-std=c++17
             ; only use C++17 or GNU++17. This is an either-or relation.
             -std=gnu++17
             -DNO_NEED_RELAY_COLLECTFUN
             -DNO_NEED_RELAYARRAY_COLLECTFUN
             -DNO_NEED_NONBLOCKINGDALLASARRAY_COLLECTFUN
             ;-DNO_NEED_COMMANDCENTER_COLLECTFUN
             ;-DNO_NEED_MQTTCOMMAND_COLLECTFUN
             ;-DNO_NEED_WIFIMANAGER_COLLECTFUN
             -DNO_NEED_CONTROLLOGICMANAGER_COLLECTFUN
             -DNO_NEED_COUNTER_COLLECTFUN

build_unflags =
  	           ;-std=gnu++17
	          -std=gnu++11
	
lib_ldf_mode = chain+
lib_compat_mode = strict

[env:esp32-s3-devkitc-1]
board = esp32-s3-devkitc-1
platform = espressif32
framework = arduino

; Override board settings for 16MB Flash + 8MB PSRAM
board_build.flash_size = 16MB
board_build.partitions = partitions_16MB.csv
board_build.arduino.memory_type = qio_opi


; Monitor settings
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

; Upload settings
upload_speed = 115200

; Build flags for PSRAM support
build_flags =
    ${env.build_flags}
    -DCORE_DEBUG_LEVEL=0
    -DBOARD_HAS_PSRAM
    -DPSRAM_SPEED=80
    -DPSRAM_MODE=0
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DCONFIG_FREERTOS_HZ=1000
    -Wno-unused-parameter
    -Wno-sign-compare

; Library dependencies
lib_deps = ${extra.lib_deps_external}
   
